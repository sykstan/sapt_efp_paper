% subsubsection 
% subsection: Scaled EFP


% correlation
In order to understand the trends between the energy components of the two methods, they were plotted against each other. 
These plots are shown in Figure \ref{fig:sapt-efp-corr-all}.
Since aug-cc-pVTZ showed the best agreement with SAPT2+3,  it will be further discussed in the text as a representative of EFP performance, since including the other basis sets would only serve to bog the reader down with excessive minutiae.
More detail on the other two basis sets can be found in ESI.
The linear correlation is visually obvious for electrostatics, exchange, induction and dispersion components.
Since both methods decompose the interaction energy into the same physically meaningful components, this comes as no surprise.
Furthermore, electrostatics and dispersion are expected to have strong linear correlations.
This is because the electrostatic component, calculated with Stone's distributed multipole analysis, was formulated against benchmark CCSD(T) and SAPT energies.
\cite{Slipchenko2007a}
As it is the largest contributor to the total interaction energy, accurate treatment of electrostatics is essential.
% TODO
Dispersion was also formulated against SAPT dispersion, and so is expected to agree well.
\cite{Adamovic2005a}
As such, attempting a linear fit between the two methods is one way of analysing the differences between the methods, thus providing more insight into why EFP might deviate from SAPT2+3 for ionic liquids.


\begin{figure}
    \caption{Comparison of the electrostatic component between SAPT2+3 and EFP. (\enUnit)}
    \label{fig:sapt-efp-corr-all}
    \centering
    % original
    %\includegraphics[scale=0.75]{\string~/GoogleDrive/SAPT-EFP/images/sapt_efp_corr/all_corr.pdf}
    \includegraphics[scale=0.75]{./images/all_corr.pdf}
\end{figure}


\begin{table}[h]
\centering
\scriptsize
\caption{Statistics from linear regression analysis of individual energy component calculated with EFP/aug-cc-pVTZ and fitted to SAPT2+3/aug-cc-pVDZ. All energies are in \enUnit~.}
\label{tab:scaled-efp-atz-coef}
\begin{tabular}{ll|rrrrr|rrrrr}
    \hline
       &          & \multicolumn{5}{c}{Halides}                                                 & \multicolumn{5}{c}{TILAs}                                            \\
           Cation & Component   & $a$    & MAE      & SD         & Max      &                                 & $a$      & MAE        & SD       & Max       &                      \\ \hline
\catb{mim}{n}     & Elst   & 1.014    & 9.3        & 11.8     & -31.2     & \ipair{mim}{4}{br}  & 0.978    & 5.3        & 6.7      & -18.6     & \ipair{mim}{4}{bfl}  \\
                  & Exch   & 0.964    & 5.8        & 7.2      & 17.1      & \ipair{mim}{3}{cl}  & 1.124    & 11.4       & 12.6     & -27.7     & \ipair{mim}{2}{dca}  \\
                  & Ind    & 1.031    & 11.4       & 14.5     & 41.8      & \ipair{mim}{3}{br}  & 1.164    & 3.2        & 4.1      & -13.1     & \ipair{mim}{1}{ntf}  \\
                  & Disp   & 1.083    & 2.8        & 3.3      & -7.0      & \ipair{mim}{4}{br}  & 0.777    & 2.5        & 3.5      & -9.8      & \ipair{mim}{2}{ntf}  \\
                  & Total  & 1.020    & 20.8       & 26.7     & 59.8      & \ipair{mim}{3}{br}  & 0.910    & 7.0        & 9.8      & 26.1      & \ipair{mim}{2}{tos}  \\ \hline
\catb{mpyr}{n}    & Elst   & 1.023    & 4.1        & 4.9      & -10.8     & \ipair{mpyr}{3}{br} & 0.994    & 4.1        & 5.1      & 13.1      & \ipair{mpyr}{2}{ntf} \\
                  & Exch   & 0.975    & 4.1        & 4.6      & 7.3       & \ipair{mpyr}{2}{cl} & 1.222    & 6.4        & 7.8      & -22.1     & \ipair{mpyr}{4}{dca} \\
                  & Ind    & 0.985    & 3.0        & 3.8      & -7.9      & \ipair{mpyr}{3}{cl} & 1.169    & 2.4        & 2.7      & 6.2       & \ipair{mpyr}{2}{tos} \\
                  & Disp   & 1.148    & 0.7        & 1.0      & -2.4      & \ipair{mpyr}{2}{br} & 0.866    & 1.2        & 1.5      & 4.8       & \ipair{mpyr}{1}{dca} \\
                  & Total  & 1.016    & 7.8        & 9.3      & -16.1     & \ipair{mpyr}{3}{br} & 0.940    & 5.2        & 6.8      & 18.7      & \ipair{mpyr}{2}{tos} \\ \hline
\end{tabular}
\end{table}


Linear regression was performed assuming a linear relationship of the form $ y = a \cdot x $.
Scaled EFP energies are obtained by multiplying the original EFP energy with the scaling coefficient.
The coefficient $a$, as well as the associated regression statistics are given in Table \ref{tab:scaled-efp-atz-coef}.
Since all of the $R^2$ values are high, falling between 0.9737 and 0.9999, they are not shown in the table (for more detail see the ESI).
Clear differences in the actual magnitude of the regression coefficient are observed between the halides and the typical ionic liquid anions.
To achieve better fitting, linear regression analysis was performed separately for the imidazolium and pyrrolidinium cations, further highlighting the importance of the cation-anion combination in determining the component-specific correlations in ionic liquids.


Analysis of Table \ref{tab:scaled-efp-atz-coef} reveals that there is a drastic improvement for the scaled dispersion and induction components, with the MAE falling below 3.2 \enUnit. 
Imidazolium halides are an exception, due to relatively large errors in the induction component (MAE = 11.4 \enUnit).
Except for these systems, maximum errors fall in a much narrower range of -13.1 to 6.2 \enUnit.
Among the components studied, the gradient falls quite close to 1 for electrostatics and exchange-repulsion within 3.5\%, whereas for halides much larger differences, between 12 and 22\%, are observed in the exchange-repulsion component for TILAs.
In general, for halides, EFP underestimates electrostatics and overestimates exchange-repulsion compared to SAPT2+3, and vice versa for the other typical IL anions.
As for the other components, EFP dose not show clear trends.
EFP tends to  underestimate induction up to 17\% for the TILAs, whereas for halides, the scaling coefficient ranges between 0.985 and 1.031.
In the case of halides, EFP underestimates dispersion between 8 and 15\%, whereas for the TILAs this component is overestimated between 13 and 23\%. 


For electrostatics and exchange, the maximum errors still fall in a wide range between -31.2 and 17.1 \enUnit.
The standard deviation is above 5 \enUnit~on average, which is still unacceptable where chemical accuracy is required.


\begin{table}[h]
\centering
\scriptsize
\caption{Relative differences (given in \%) for EFP scaled energetic components and total interaction energy compared to SAPT2+3.}
\label{tab:scaled-perc-stats-atz}
\begin{tabular}{ll|rrrr|rrrr}
\hline
 Cation                & Component & \multicolumn{4}{c}{Halides}                  & \multicolumn{4}{c}{TILAs}              \\
                       &        & MAE  & SD  & Max  &                          & MAE  & SD  & Max  &                   \\ \hline
\catb{mim}{n}          & Elst   & 2.1  & 1.6 & 6.8  & \ipair{mim}{4}{br}   & 1.4  & 1.0 & 4.9  & \ipair{mim}{4}{bfl}   \\
                       & Exch   & 3.3  & 2.5 & 9.9  & \ipair{mim}{3}{cl}   & 10.2 & 4.8 & 25.7 & \ipair{mim}{2}{dca}   \\
                       & Ind    & 12.5 & 9.3 & 44.4 & \ipair{mim}{3}{br}   & 6.2  & 4.1 & 19.6 & \ipair{mim}{1}{ntf}   \\
                       & Disp   & 5.9  & 4.2 & 15.6 & \ipair{mim}{4}{br}   & 4.2  & 4.3 & 18.8 & \ipair{mim}{1}{ntf}   \\
                       & Total  & 5.2  & 4.1 & 15.5 & \ipair{mim}{3}{br}   & 1.8  & 1.7 & 6.3  & \ipair{mim}{2}{tos}   \\ \hline
\catb{mpyr}{n}         & Elst   & 1.0  & 0.6 & 2.6  & \ipair{mpyr}{3}{br}  & 1.2  & 0.9 & 4.3  & \ipair{mpyr}{2}{ntf}  \\
                       & Exch   & 2.9  & 1.4 & 5.3  & \ipair{mpyr}{3}{cl}  & 7.8  & 6.0 & 31.6 & \ipair{mpyr}{4}{dca}  \\
                       & Ind    & 4.0  & 3.0 & 10.4 & \ipair{mpyr}{3}{cl}  & 4.8  & 2.4 & 9.1  & \ipair{mpyr}{2}{tos}  \\
                       & Disp   & 1.7  & 1.3 & 5.1  & \ipair{mpyr}{2}{br}  & 2.9  & 2.3 & 11.3 & \ipair{mpyr}{1}{dca}  \\
                       & Total  & 2.1  & 1.2 & 4.2  & \ipair{mpyr}{3}{br}  & 1.4  & 1.2 & 4.7  & \ipair{mpyr}{2}{tos}  \\ \hline
\end{tabular}
\end{table}


% message: errors *are* reducing, but not enough
Table \ref{tab:scaled-perc-stats-atz} shows the relative errors in percentage of the scaled EFP energetic components and the total interaction energy with respect to SAPT.
One can clearly see that the errors for the induction and dispersion components reduce to below 20\%.
For the dispersion term, this can be expected, as the dispersion component in EFP was formulated against SAPT dispersion.
\cite{Adamovic2005a}
It is important to note that \catb{mpyr}{n}[Hal] systems performed exceptionally well, with a maximum error of 10.4\% for induction, and only 5.1\% for dispersion.
The exchange component still gives errors between 5.3\% for \catb{mpyr}{n} halides and 31.6\% for the pyrrolidinium ion pairs coupled with the TILAs.
Although the relative error for electrostatics drops below 10\% for all systems under study (with all three basis sets), due to the magnitude of this component, maximum errors can still exceed -30 \enUnit~(\emph{e.g.} in the case of \ipair{mim}{4}{br}).
The same applies to the exchange-repulsion component that gives relative errors below 3.3\% on average, whereas the maximum errors can still be up to -27.7 \enUnit~ as observed for \ipair{mim}{2}{dca}.


\begin{figure}[h]
    \caption{Distribution of the raw and scaled differences (\enUnit) between SAPT and EFP, by energetic component and anion type, coloured by cation.}
    \label{fig:hist-raw-scaled-atz}
    \centering
    % original
    %\includegraphics[scale=0.5]{\string~/GoogleDrive/SAPT-EFP/images/histograms/hist_by_En_atz_raw_scaled.pdf}
    \includegraphics[scale=0.5]{./images/hist_by_En_atz_raw_scaled.pdf}
\end{figure}


In Figure \ref{fig:hist-raw-scaled-atz} the distribution of EFP errors, raw and scaled, for individual energetic component is shown.
The solid histograms are the raw differences, whereas the line density plots are the errors obtained after scaling.
The line density distributions are kernel distributions plotted using the normal kernel.
They represent the smoothed count and are analogous to the histograms.
The plots are separated in a grid based on the component of the interaction energy, as well as the type of anion, halides and TILAs.
As expected, the scaling shifts the mean of the distribution for each component towards zero.
In particular, the scaling achieves narrower distributions for some components, such as dispersion and induction.
It appears that linear regression did not improve the spread of errors for electrostatics and exchange-repulsion, indicating that there are shortcomings in the EFP formulation of these components when applied to ionic liquids.


\begin{table}
\centering
\footnotesize
\caption{Statistics of the differences between first order electrostatics and exchange-repulsion calculated in SAPT2+3 and their full components in EFP. All energies are given in \enUnit.}
\label{tab:trunc-stats-atz}
\begin{tabular}{lllrrrr}
\hline
 Component   &  Cation                          & Anion-type & MAE    & SD     & Max     &                           \\ \hline
 Elst     &  \multirow{2}{*}{\catb{mim}{n}}  & Hal        &  9.7   & 12.1   & -31.0   & \ipair{mim}{4}{br}    \\ 
          &                                  & TILA        &  10.9  & 6.3    & 28.5    & \ipair{mim}{2}{tos}   \\
          &  \multirow{2}{*}{\catb{mpyr}{n}} & Hal        &  5.0   & 4.8    & -14.8   & \ipair{mpyr}{3}{br}   \\
          &                                  & TILA        &  4.9   & 4.9    & 15.0    & \ipair{mpyr}{2}{ntf}  \\ \hline
 Exch     &  \multirow{2}{*}{\catb{mim}{n}}  & Hal        & 27.5   & 10.1   & -41.3   & \ipair{mim}{4}{br}    \\
          &                                  & TILA        & 4.2    & 5.3    & -19.2   & \ipair{mim}{2}{dca}   \\
          &  \multirow{2}{*}{\catb{mpyr}{n}} & Hal        & 21.4   & 5.0    & -28.0   & \ipair{mpyr}{3}{br}   \\
          &                                  & TILA        & 4.0    & 3.3    & -11.0   & \ipair{mpyr}{4}{dca}  \\ \hline
\end{tabular}
\end{table}


It is hypothesized that the errors from electrostatics and exchange-repulsion come from the fact that higher-order contributions are not included in the EFP formulation.
In order to test this hypothesis, first order electrostatic and first order exchange components calculated with SAPT2+3 were compared with their corresponding EFP components. 
the statistics on these differences are given in Table \ref{tab:trunc-stats-atz}.
Only a small difference in errors was observed for electrostatics, thus indicating that perhaps higher-order terms do not contribute significantly to the electrostatic interaction.
As for the exchange-repulsion component, the difference between first-order SAPT and full EFP is reduced to below 4.2 \enUnit~on average for all ion pairs with TILAs.
For comparison, the errors for EFP exchange-repulsion were almost triple that for halides when compared with the first-order exchange-repulsion energy in SAPT2+3.
For example, for the imidazolium based halides the MAE increases from 8.6 to 27.5 \enUnit.


These findings clearly indicate the importance of higher-order terms in exchange-repulsion for typical ionic liquids anions but not halides.
Compared to the correlations between SAPT2+3 and EFP in Table \ref{tab:scaled-efp-atz-coef} for the halide systems, exchange is slightly overestimated by EFP, by about 3\%, whereas in the TILAs, EFP underestimates exchange between 12 and 22\% on average. 
While halides have a higher exchange energy in general, roughly 60~\enUnit~ more than that of the other TILAs, they also give smaller errors. 
Due to the increased orbital overlap between the halide anion and the cation, the optimal geometry of the ion pair has shorter distances between the cation and anion, thus resulting in higher exchange-repulsion energies.
It is suggested that having a single atom as the anion reduces the complexity of the interaction, and is thus better modelled by EFP.
On the other hand, the TILAs are more complex as they have multiple interaction sites.
In this case, the optimal geometry of the ion pair positions the anion further away from the cation, leading to lower exchange-repulsion energies.
At the same time, due to the presence of multiple interaction sites, the overall error increases with the number of possible interaction sites on the anion.


\begin{table}[ht]
\centering
\footnotesize
\caption{Contributions (given in \enUnit) from higher-order terms in electrostatics and exchange-repulsion for ionic liquid ion pairs and the intermolecular complexes in the S22 and S66 databases.}
\label{tab:s22-s66-trunc}
\begin{tabular}{llrrrr}
  \hline
Component & Set & Mean  & SD & Max &                            \\ \hline
Elst   & \catb{mim}{n}  & 2.92 & 2.74 & -6.52 & \ipair{mim}{2}{br}    \\ 
       & \catb{mpyr}{n} & 2.13 & 1.90 & -5.15 & \ipair{mpyr}{1}{br}   \\ 
       & S22 & 1.36 & 1.67 & 6.13  & Uracil dimer        \\ 
       & S66 & 1.19 & 1.46 & 5.32  & Complex of acetic acid and Uracil \\ \hline
Exch   & \catb{mim}{n}  & 18.07 & 6.86 & 28.40 & \ipair{mim}{4}{tos}      \\ 
       & \catb{mpyr}{n} & 14.05 & 4.89 & 20.93 & \ipair{mpyr}{2}{mes}     \\ 
       & S22 & 8.08  & 8.30 & 21.73 & Complex of 2-Pyridoxine and 2-Aminopyridine  \\
       & S66 & 5.30  & 5.89 & 29.85 & Acetic acid dimer    \\ \hline
\end{tabular}
\end{table}


\begin{table}[ht]
\centering
\footnotesize
\caption{Relative contributions (given in \%) from higher order terms in electrostatics and exchange for ionic liquid ion pairs and the intermolecular complexes in the S22 and S66 databases.}
\label{tab:s22-s66-perc}
\begin{tabular}{llrrrr}
  \hline
 Component & Set & Mean  & SD     &  Max   &                           \\ \hline
 Elst   & \catb{mim}{n}  & 0.72 &  0.66  &  1.41  & \ipair{mim}{2}{br}    \\ 
        & \catb{mpyr}{n} & 0.58 &  0.49  &  1.26  & \ipair{mpyr}{1}{br}   \\ 
        & S22 & 4.05 &  5.03  & -19.09 & Complex of Benzene and hydrogen cyanide  \\
        & S66 & 6.32 &  7.87  & -19.43 & Ethyne dimer          \\ \hline
 Exch   & \catb{mim}{n}  & 13.47 & 4.95 & 20.16 & \ipair{mim}{4}{bfl}       \\ 
        & \catb{mpyr}{n} & 14.31 & 3.86 & 19.14 & \ipair{mpyr}{4}{bfl}     \\ 
        & S22 & 10.86 & 4.53 & 16.50 & Phenol dimer                 \\
        & S66 & 11.97 & 4.62 & 18.61 & Complex of methanol and model peptide \\ \hline
\end{tabular}
\end{table}


Tables \ref{tab:s22-s66-trunc} and \ref{tab:s22-s66-perc} show the actual contributions of higher-order terms to the electrostatic and exchange components in SAPT2+3.
The tables contrast contributions for the ionic liquid systems studied to the neutral intermolecular complexes taken from the S22 and S66 databases.
Surprisingly, for the higher-order contributions of the electrostatic component in ionic liquids, only slight differences were observed between ionic liquids and neutral complexes.
The maximum contribution did not exceed 6.5 \enUnit~for all systems, be it ionic or neutral.
On the relative scale, these contributions constitute a much smaller portion of the electrostatic component, usually below 1\%. 
On the other hand, the neutral complexes from S22 and S66 show a much higher relative contribution, up to 19\% in some cases, for example in the ethyne dimer.

For exchange-repulsion, the higher-order contributions are larger for ionic liquids on the absolute scale when compared to the neutral complexes.
Nevertheless, the maximum contributions could be not be split between ionic and neutral systems, with both types of complexes having higher-order contributions of up to 30 \enUnit.
Hydrogen-bonded complexes from the S22 and S66 databases tend to have a larger exchange-repulsion component due to increased orbital overlap.
Furthermore, on the relative scale, the higher-order contributions fall in a narrow range of 11\% for neutral complexes and 14\% for ionic liquids.
As established above, for ionic liquids EFP matches SAPT2+3 exchange-repulsion energies up to the first order only as seen in Table \ref{tab:s22-s66-perc}.
Higher-order exchange-repulsion terms are equally important in ionic and neutral complexes, thus suggesting that EFP shortcomings in exchange are not restricted to semi-Coulombic systems such as ionic liquids.
The magnitude of the error for exchange-repulsion in EFP is dependent on the complexity of the intermolecular interaction and proximity of interacting charged species. 
It has to be pointed out that the absolute error also increases as the magnitude of the energy increases, despite the relative error remaining practically constant.

To summarise, good linear correlations have been achieved for the induction and dispersion components between the EFP and SAPT2+3 methods for ionic liquids. This clearly introduces huge potential for improvement of these terms in the EFP formulation. Electrostatic and exchange-repulsion components calculated with EFP show the largest deviations. For the former this finding was attributed to deficiency in the EFP method for recovering electrostatics, whereas for the latter higher-order terms (currently missing in the EFP formulation) were found to be important for ionic liquids, especially those containing anions with multiple interaction sites.   

